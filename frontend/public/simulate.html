<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Z16 Simulator Upload</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="Simulate.css" />
</head>
<body>
<div class="bg-pattern"></div>
<div class="floating-elements">
    <div class="floating-circle"></div>
    <div class="floating-circle"></div>
    <div class="floating-circle"></div>
</div>

<div class="container">
    <button class="btn btn-primary" onclick="animateClick(this); window.location.href='index.html'">
    <img src="home-page.png" alt="Home" style="height: 20px; margin-right: 8px; vertical-align: middle;" />
    Return Home
</button>


    <h1>Run Z16 Simulation</h1>

    <div class="upload-box">
        <label for="binfile">Choose a .bin file:</label>
        <input type="file" id="binfile" accept=".bin" />

        <button class="btn btn-primary" onclick="animateClick(this); submitBinary()">
            <img src="screen.png" alt="search icon" style="height: 20px; margin-right: 8px; vertical-align: middle;" />
            Run Full Simulation
        </button>

        <button id="stepByStepBtn" class="btn btn-primary">
            <img src="search.png" alt="step icon" style="height: 20px; margin-right: 8px; vertical-align: middle;" />
            Run Step-by-step
        </button>

        <button id="quitStepByStepBtn" class="btn btn-primary" style="display: none;">
            <img src="delete.png" alt="quit icon" style="height: 20px; margin-right: 8px; vertical-align: middle;" />
            Quit Step-by-step
        </button>
        <button id="nextLineBtn" class="btn btn-primary" style="display: none;">
            <img src="right-arrow.png" alt="next icon" style="height: 20px; margin-right: 8px; vertical-align: middle;" />
            Next
        </button>


    </div>

    <pre id="output"></pre>
</div>
<script>
    let stepLines = [];
    let stepIndex = 0;

    function animateClick(btn) {
        btn.classList.add('clicked');
        setTimeout(() => btn.classList.remove('clicked'), 150);
    }

    function submitBinaryStepByStep() {
        const fileInput = document.getElementById('binfile');
        const output = document.getElementById('output');

        if (!fileInput.files.length) {
            output.textContent = "❌ Please select a .bin file first.";
            return;
        }

        output.textContent = "⏳ Preparing step-by-step output...\n";

        // UI: show buttons
        document.getElementById('stepByStepBtn').style.display = 'none';
        document.getElementById('quitStepByStepBtn').style.display = 'inline-flex';
        document.getElementById('nextLineBtn').style.display = 'inline-flex';

        const formData = new FormData();
        formData.append('binfile', fileInput.files[0]);

        fetch('http://localhost:5001/simulate', {
            method: 'POST',
            body: formData
        })
            .then(res => res.text())
            .then(data => {
                stepLines = data.split('\n');
                stepIndex = 0;
                output.textContent = "✅ Ready. Click 'Next' to begin...\n";
            })
            .catch(err => {
                output.textContent = "❌ Error: " + (err.error || "Unknown error");
                document.getElementById('stepByStepBtn').style.display = 'inline-flex';
                document.getElementById('quitStepByStepBtn').style.display = 'none';
                document.getElementById('nextLineBtn').style.display = 'none';
            });
    }

    function showNextLine() {
        const output = document.getElementById('output');
        if (stepIndex < stepLines.length) {
            output.textContent += stepLines[stepIndex] + '\n';
            stepIndex++;
        } else {
            output.textContent += "\n✅ Step-by-step simulation complete.";
            document.getElementById('nextLineBtn').style.display = 'none';
            document.getElementById('quitStepByStepBtn').style.display = 'none';
            document.getElementById('stepByStepBtn').style.display = 'inline-flex';
        }
    }

    function quitStepByStep() {
        document.getElementById('nextLineBtn').style.display = 'none';
        document.getElementById('quitStepByStepBtn').style.display = 'none';
        document.getElementById('stepByStepBtn').style.display = 'inline-flex';
        document.getElementById('output').textContent += "\n⛔️ Step-by-step simulation stopped.";
    }

    // Button handlers
    document.getElementById('stepByStepBtn').addEventListener('click', submitBinaryStepByStep);
    document.getElementById('nextLineBtn').addEventListener('click', showNextLine);
    document.getElementById('quitStepByStepBtn').addEventListener('click', quitStepByStep);
</script>


</body>
</html>
